<div class="dashboard-background">
  <div class="card">
    <div class="row">
      <div class="col-sm-6">
        <div class="card-title">Students</div>
      </div>
      <div class="col-sm-6">
        <div class="pull-right utility-buttons">
          <div (click)="dashboardState='addStudent'" [ngClass]="{disabled:dashboardState!=='default'}" class="btn btn-outline-primary ">Add Student
            <i class="fa fa-user-plus" aria-hidden="true"></i>
          </div>
          <div class="btn btn-primary" (click)="dashboardState='trackingHomework'" [ngClass]="{disabled:dashboardState!=='default'}">Track Homework
            <i class="fa fa-check" aria-hidden="true"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="row" *ngIf="dashboardState=='trackingHomework'">
      <div class="descriptionTitle col-sm-12 " [ngClass]="{'danger':descriptionField.invalid&&descriptionField.touched}">Homework Name</div>
      <div class="col-sm-12 search">
        <input type="text" class="form-control descriptionField" [(ngModel)]="descriptionText" [ngClass]="{'is-invalid':descriptionField.invalid&&descriptionField.touched}"
          name="descriptionText" #descriptionField="ngModel" autocomplete="new-password" autocomplete="off" required>
        <i class="fa fa-file-o" aria-hidden="true"></i>
        <div *ngIf="descriptionField.invalid && (descriptionField.dirty || descriptionField.touched)" class="row">
          <div *ngIf='descriptionField.errors.required' class="col-sm-12 text-danger">
            Please give your homework a name
          </div>
        </div>
      </div>
    </div>
    <!-- <div class="row">
      {{dashboardState}}
    </div>
    <div class="row">
      {{descriptionText}}
    </div> -->

    <!-- Beginning of table -->
    <table class="table">
      <thead>
        <tr>
          <th style="width:5%">Actions</th>
          <th style="width:10%">Last Name</th>
          <th style="width:10%">First Name</th>
          <th style="width:10%">E-mail</th>
          <th style="width:30%"></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let student of students">
          <!-- display the following if the student isn't in edit mode -->
          <td *ngIf="!student.edit">
            <div class="btn btn-action" [ngClass]="{disabled:dashboardState!=='default'}" (click)="student.edit=true" (click)="dashboardState='editState'"
              *ngIf="dashboardState=='editState'||dashboardState=='default'">Edit
              <i class="fa fa-pencil" aria-hidden="true"></i>
            </div>
            <div class="track-homework-actions" *ngIf="dashboardState==='trackingHomework'">
              <form>
                <i class="fa fa-minus" [ngClass]="{'selected':student.status=='NA'}" aria-hidden="true" (click)="student.status='NA'"></i>
                <i class="fa fa-close" [ngClass]="{'selected':student.status=='incompleted'}" aria-hidden="true" (click)="student.status='incompleted'"></i>
                <i class="fa fa-check" [ngClass]="{'selected':student.status=='completed'}" aria-hidden="true" (click)="student.status='completed'"></i>
              </form>
            </div>
          </td>
          <td *ngIf="!student.edit" (click)="dashboardState='studentInfoModal'" (click)="markStudentForInfo(student)">{{student.lastName}}</td>
          <td *ngIf="!student.edit" (click)="dashboardState='studentInfoModal'" (click)="markStudentForInfo(student)">{{student.firstName}}</td>
          <td *ngIf="!student.edit" (click)="dashboardState='studentInfoModal'" (click)="markStudentForInfo(student)">{{student.parentEmail}}</td>
          <td *ngIf="!student.edit" (click)="dashboardState='studentInfoModal'" (click)="markStudentForInfo(student)">{{student.status}}</td>

          <!-- this the following IF the student is in edit mode and dashboard is in default mode -->
          <td *ngIf="student.edit">
            <div class="btn btn-action" (click)="student.edit=false" (click)="dashboardState='default'">Cancel
              <i class="fa fa-pencil" aria-hidden="true"></i>
            </div>
            <div class="track-homework-actions" *ngIf="dashboardState==='trackingHomework'">
              <form>
                <i class="fa fa-minus tooltip" aria-hidden="true" (click)="student.homeworkStatus='NA'"></i>
                <i class="fa fa-close" aria-hidden="true" (click)="student.homeworkStatus='incompleted'"></i>
                <i class="fa fa-check" aria-hidden="true" (click)="student.homeworkStatus='completed'"></i>
              </form>
            </div>
          </td>
          <td *ngIf="student.edit">
            <input type="string" class="form-control" [ngClass]="{'is-invalid':studentLastName.invalid&&studentLastName.touched}" [(ngModel)]="student.lastName"
              name="lastName" #studentLastName="ngModel" autocomplete="new-password" autocomplete="off" pattern="[a-zA-Z]*"
              required>
            <div *ngIf="studentLastName.invalid && (studentLastName.dirty || studentLastName.touched)" class="row">
              <div *ngIf='studentLastName.errors.required' class="col-sm-12 text-danger">
                Last name is required
              </div>
              <div *ngIf='studentLastName.errors?.pattern' class="col-sm-12 text-danger">
                Invalid Format
              </div>
            </div>
          </td>
          <td *ngIf="student.edit">
            <input type="string" class="form-control" [ngClass]="{'is-invalid':studentFirstName.invalid&&studentFirstName.touched}" [(ngModel)]="student.firstName"
              name="FirstName" #studentFirstName="ngModel" autocomplete="new-password" autocomplete="off" pattern="[a-zA-Z]*"
              required p>
            <div *ngIf="studentFirstName.invalid && (studentFirstName.dirty || studentFirstName.touched)" class="row">
              <div *ngIf='studentFirstName.errors.required' class="col-sm-12 text-danger">
                First name is required
              </div>
              <div *ngIf='studentFirstName.errors?.pattern' class="col-sm-12 text-danger">
                Invalid Format
              </div>
            </div>
          </td>
          <td *ngIf="student.edit">
            <input type="email" class="form-control" [ngClass]="{'is-invalid':parentEmail.invalid&&parentEmail.touched}" [(ngModel)]="student.parentEmail"
              name="email" #parentEmail="ngModel" autocomplete="new-password" autocomplete="off">
          </td>
          <td *ngIf="student.edit">
            <div class="confirm-cancel-btns">
              <div class="btn btn-confirm" (click)="saveStudentChanges(student)">Save
                <i class="fa fa-save" aria-hidden="true"></i>
              </div>
              <div class="btn btn-cancel" (click)="dashboardState='deleteStudentModal'" (click)="markStudentForDeletion(student)">Delete
                <i class="fa fa-save" aria-hidden="true"></i>
              </div>
            </div>
          </td>
        </tr>


        <!-- Begin add student line at the bottom of table -->
        <tr *ngIf="dashboardState==='addStudent'">
          <td></td>
          <td>
            <input type="string" class="form-control" [ngClass]="{'is-invalid':studentLastName.invalid&&studentLastName.touched}" [(ngModel)]="studentInfo.lastName"
              name="lastName" #studentLastName="ngModel" autocomplete="new-password" autocomplete="off" pattern="[a-zA-Z]*"
              required>
            <div *ngIf="studentLastName.invalid && (studentLastName.dirty || studentLastName.touched)" class="row">
              <div *ngIf='studentLastName.errors.required' class="col-sm-12 text-danger">
                Last name is required
              </div>
              <div *ngIf='studentLastName.errors?.pattern' class="col-sm-12 text-danger">
                Invalid Format
              </div>
            </div>
          </td>
          <td>
            <input type="string" class="form-control" [ngClass]="{'is-invalid':studentFirstName.invalid&&studentFirstName.touched}" [(ngModel)]="studentInfo.firstName"
              name="FirstName" #studentFirstName="ngModel" autocomplete="new-password" autocomplete="off" pattern="[a-zA-Z]*"
              required p>
            <div *ngIf="studentFirstName.invalid && (studentFirstName.dirty || studentFirstName.touched)" class="row">
              <div *ngIf='studentFirstName.errors.required' class="col-sm-12 text-danger">
                First name is required
              </div>
              <div *ngIf='studentFirstName.errors?.pattern' class="col-sm-12 text-danger">
                Invalid Format
              </div>
            </div>
          </td>
          <td>
            <input type="email" class="form-control" [ngClass]="{'is-invalid':parentEmail.invalid&&parentEmail.touched}" [(ngModel)]="studentInfo.parentEmail"
              name="email" #parentEmail="ngModel" autocomplete="new-password" autocomplete="off">
          </td>
          <td>
            <div class="confirm-cancel-btns">
              <div class="btn btn-confirm" [ngClass]="{disabled:studentFirstName.invalid||studentLastName.invalid||parentEmail.invalid}"
                (click)="addStudent()">Save
                <i class="fa fa-save" aria-hidden="true"></i>
              </div>
              <div class="btn btn-cancel" (click)="dashboardState='default'">Cancel
                <i class="fa fa-save" aria-hidden="true"></i>
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div *ngIf="dashboardState==='trackingHomework'" class="confirm-cancel-btns tracking-action-buttons">
    <div class="btn btn-confirm" (click)="recordStudents()" (click)="dashboardState='default'">Save
      <i class="fa fa-save" aria-hidden="true"></i>
    </div>
    <div class="btn btn-cancel" (click)="dashboardState='default'" (click)="resetTrackingStates()">Cancel
      <i class="fa fa-save" aria-hidden="true"></i>
    </div>
  </div>
  <div class="toast-wrapper show hide">
    <i class="fa fa-close" aria-hidden="true"></i>
    <div class="description">Homework check was not saved, please try again</div>
    <div class="action">Dismiss</div>
  </div>
</div>

<!-- deleteStudentModal -->
<div class="delete-student-modal-wrapper" *ngIf="dashboardState === 'deleteStudentModal'">
  <div class="modal-card card">
    <div class="card-title">
      <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>Warning</div>
    <div class="modal-description">
      Are you sure you want to delete this student?
    </div>
    <div class="modal-buttons">
      <div class="btn btn-cancel" (click)="deleteStudent()">Continue</div>
      <div class="btn blank" (click)="dashboardState='default'">cancel</div>
    </div>
  </div>
  <div class="modal-background"></div>
</div>

<!-- studentInfo Modal -->
<div class="info-modal-wrapper" *ngIf="dashboardState === 'studentInfoModal'">
  <div class="modal-card card">
    <div class="row">
      <div class="col-sm-6">
        <div class="card-title">{{studentMarkedForInfo.lastName}}, {{studentMarkedForInfo.firstName}}</div>
      </div>
      <div class="col-sm-6">
        <div class="rating pull-right">50%
          <!-- put popup here with position relative -->
          <!-- <div class="card popup">Popup</div> -->
        </div>

      </div>
    </div>
    <div class="row">
      <table class="table">
        <thead>
          <tr>
            <!-- <th style="width:20%">Date</th> -->
            <th style="width:50%">Homework Description</th>
            <th style="width:30%" class="text-center">Status</th>
          </tr>
        </thead>
        <tbody>
          <!-- Display a message if there are no assignments tracked yet -->
          <tr *ngIf="assignments==''">
            <!-- <th scope="row">2017/01/21</th> -->
            <td>No Homework Assignments Tracked</td>
            <td></td>
          </tr>
          <!-- List all of the assignments -->
          <tr *ngFor="let assignment of assignments">
            <!-- <th scope="row">2017/01/21</th> -->
            <td>{{assignment.AssignmentDescription}}</td>
            <td class="text-center" *ngIf="assignment.Status == 'completed'">
              <i class="fa fa-check" aria-hidden="true"></i>
            </td>
            <td class="text-center" *ngIf="assignment.Status == 'Homework was not tracked'">
              <i class="fa fa-minus" aria-hidden="true"></i>
            </td>
            <td class="text-center" *ngIf="assignment.Status == 'incompleted'">
              <i class="fa fa-close" aria-hidden="true"></i>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="modal-background" (click)="dashboardState = 'default'"></div>
</div>